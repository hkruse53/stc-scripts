#!/usr/bin/python3

import datetime
import os.path

from dtnsense import atsci, site

cfg = site.Config(os.path.expanduser("~/conf/site.conf"))

with atsci.AtSciSensor() as sensor:
    sensor.switch(atsci.TEMP)
    temp = float(sensor.ask("R"))

    sensor.switch(atsci.COND)
    sensor.write("T,{:.3f}".format(temp))
    [cond, tds, sal, sg] = (float(x) for x in sensor.ask("R").split(b","))

    sensor.switch(atsci.PH)
    sensor.write("T,{:.3f}".format(temp))
    ph = float(sensor.ask("R"))

    now = datetime.datetime.utcnow()

    record = site.Record(cfg, now, temp, ph, cond)
    signed = site.SignedRecord(record, cfg)

    print(signed)
