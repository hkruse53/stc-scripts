#!/bin/bash

SSID=$1

if [[ -z $SSID ]]; then
    echo Usage: $0 SSID
    exit 1
fi

finish() {
    # Shut down the monitor and delete it.
    ip link set mon0 down
    iw dev mon0 del
    exit
}

trap finish EXIT

# Create the monitor interface and bring it up.
iw dev wlan0 interface add mon0 type monitor || exit 1
ip link set mon0 up

coproc DUMP {
    tcpdump -l -i mon0 "(type mgt subtype beacon)" 2>/dev/null
}

# Wait for the first beacon frame from the given SSID.
wait-line "($SSID)" <&${DUMP[0]}
